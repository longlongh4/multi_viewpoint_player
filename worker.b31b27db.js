(()=>{function e(e,t){let i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}var t=class{#e=null;#t=null;constructor(e){this.#e=e,this.#t=e.getContext("2d")}draw(e){this.#e.width=e.displayWidth,this.#e.height=e.displayHeight,this.#t.drawImage(e,0,0,e.displayWidth,e.displayHeight)}};class i{constructor(e,t){this.code="",this.scopes=[["vars"]],this.bitFields=[],this.tmpVariableCount=0,this.references=new Map,this.imports=[],this.reverseImports=new Map,this.useContextVariables=!1,this.importPath=e,this.useContextVariables=t}generateVariable(e){const t=[...this.scopes[this.scopes.length-1]];return e&&t.push(e),t.join(".")}generateOption(e){switch(typeof e){case"number":return e.toString();case"string":return this.generateVariable(e);case"function":return`${this.addImport(e)}.call(${this.generateVariable()}, vars)`}}generateError(e){this.pushCode(`throw new Error(${e});`)}generateTmpVariable(){return"$tmp"+this.tmpVariableCount++}pushCode(e){this.code+=e+"\n"}pushPath(e){e&&this.scopes[this.scopes.length-1].push(e)}popPath(e){e&&this.scopes[this.scopes.length-1].pop()}pushScope(e){this.scopes.push([e])}popScope(){this.scopes.pop()}addImport(e){if(!this.importPath)return`(${e})`;let t=this.reverseImports.get(e);return t||(t=this.imports.push(e)-1,this.reverseImports.set(e,t)),`${this.importPath}[${t}]`}addReference(e){this.references.has(e)||this.references.set(e,{resolved:!1,requested:!1})}markResolved(e){const t=this.references.get(e);t&&(t.resolved=!0)}markRequested(e){e.forEach((e=>{const t=this.references.get(e);t&&(t.requested=!0)}))}getUnresolvedReferences(){return Array.from(this.references).filter((([e,t])=>!t.resolved&&!t.requested)).map((([e,t])=>e))}}const r=new Map,s="___parser_",n={uint8:1,uint16le:2,uint16be:2,uint32le:4,uint32be:4,int8:1,int16le:2,int16be:2,int32le:4,int32be:4,int64be:8,int64le:8,uint64be:8,uint64le:8,floatle:4,floatbe:4,doublele:8,doublebe:8},o={uint8:"Uint8",uint16le:"Uint16",uint16be:"Uint16",uint32le:"Uint32",uint32be:"Uint32",int8:"Int8",int16le:"Int16",int16be:"Int16",int32le:"Int32",int32be:"Int32",int64be:"BigInt64",int64le:"BigInt64",uint64be:"BigUint64",uint64le:"BigUint64",floatle:"Float32",floatbe:"Float32",doublele:"Float64",doublebe:"Float64"},a={uint8:!1,uint16le:!0,uint16be:!1,uint32le:!0,uint32be:!1,int8:!1,int16le:!0,int16be:!1,int32le:!0,int32be:!1,int64be:!1,int64le:!0,uint64be:!1,uint64le:!0,floatle:!0,floatbe:!1,doublele:!0,doublebe:!1};class h{constructor(){this.varName="",this.type="",this.options={},this.endian="be",this.useContextVariables=!1}static start(){return new h}primitiveGenerateN(e,t){const i=o[e],r=a[e];t.pushCode(`${t.generateVariable(this.varName)} = dataView.get${i}(offset, ${r});`),t.pushCode(`offset += ${n[e]};`)}primitiveN(e,t,i){return this.setNextParser(e,t,i)}useThisEndian(e){return e+this.endian.toLowerCase()}uint8(e,t={}){return this.primitiveN("uint8",e,t)}uint16(e,t={}){return this.primitiveN(this.useThisEndian("uint16"),e,t)}uint16le(e,t={}){return this.primitiveN("uint16le",e,t)}uint16be(e,t={}){return this.primitiveN("uint16be",e,t)}uint32(e,t={}){return this.primitiveN(this.useThisEndian("uint32"),e,t)}uint32le(e,t={}){return this.primitiveN("uint32le",e,t)}uint32be(e,t={}){return this.primitiveN("uint32be",e,t)}int8(e,t={}){return this.primitiveN("int8",e,t)}int16(e,t={}){return this.primitiveN(this.useThisEndian("int16"),e,t)}int16le(e,t={}){return this.primitiveN("int16le",e,t)}int16be(e,t={}){return this.primitiveN("int16be",e,t)}int32(e,t={}){return this.primitiveN(this.useThisEndian("int32"),e,t)}int32le(e,t={}){return this.primitiveN("int32le",e,t)}int32be(e,t={}){return this.primitiveN("int32be",e,t)}bigIntVersionCheck(){if(!DataView.prototype.getBigInt64)throw new Error("BigInt64 is unsupported on this runtime")}int64(e,t={}){return this.bigIntVersionCheck(),this.primitiveN(this.useThisEndian("int64"),e,t)}int64be(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("int64be",e,t)}int64le(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("int64le",e,t)}uint64(e,t={}){return this.bigIntVersionCheck(),this.primitiveN(this.useThisEndian("uint64"),e,t)}uint64be(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("uint64be",e,t)}uint64le(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("uint64le",e,t)}floatle(e,t={}){return this.primitiveN("floatle",e,t)}floatbe(e,t={}){return this.primitiveN("floatbe",e,t)}doublele(e,t={}){return this.primitiveN("doublele",e,t)}doublebe(e,t={}){return this.primitiveN("doublebe",e,t)}bitN(e,t,i){return i.length=e,this.setNextParser("bit",t,i)}bit1(e,t={}){return this.bitN(1,e,t)}bit2(e,t={}){return this.bitN(2,e,t)}bit3(e,t={}){return this.bitN(3,e,t)}bit4(e,t={}){return this.bitN(4,e,t)}bit5(e,t={}){return this.bitN(5,e,t)}bit6(e,t={}){return this.bitN(6,e,t)}bit7(e,t={}){return this.bitN(7,e,t)}bit8(e,t={}){return this.bitN(8,e,t)}bit9(e,t={}){return this.bitN(9,e,t)}bit10(e,t={}){return this.bitN(10,e,t)}bit11(e,t={}){return this.bitN(11,e,t)}bit12(e,t={}){return this.bitN(12,e,t)}bit13(e,t={}){return this.bitN(13,e,t)}bit14(e,t={}){return this.bitN(14,e,t)}bit15(e,t={}){return this.bitN(15,e,t)}bit16(e,t={}){return this.bitN(16,e,t)}bit17(e,t={}){return this.bitN(17,e,t)}bit18(e,t={}){return this.bitN(18,e,t)}bit19(e,t={}){return this.bitN(19,e,t)}bit20(e,t={}){return this.bitN(20,e,t)}bit21(e,t={}){return this.bitN(21,e,t)}bit22(e,t={}){return this.bitN(22,e,t)}bit23(e,t={}){return this.bitN(23,e,t)}bit24(e,t={}){return this.bitN(24,e,t)}bit25(e,t={}){return this.bitN(25,e,t)}bit26(e,t={}){return this.bitN(26,e,t)}bit27(e,t={}){return this.bitN(27,e,t)}bit28(e,t={}){return this.bitN(28,e,t)}bit29(e,t={}){return this.bitN(29,e,t)}bit30(e,t={}){return this.bitN(30,e,t)}bit31(e,t={}){return this.bitN(31,e,t)}bit32(e,t={}){return this.bitN(32,e,t)}namely(e){return r.set(e,this),this.alias=e,this}skip(e,t={}){return this.seek(e,t)}seek(e,t={}){if(t.assert)throw new Error("assert option on seek is not allowed.");return this.setNextParser("seek","",{length:e})}string(e,t){if(!t.zeroTerminated&&!t.length&&!t.greedy)throw new Error("One of length, zeroTerminated, or greedy must be defined for string.");if((t.zeroTerminated||t.length)&&t.greedy)throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.");if(t.stripNull&&!t.length&&!t.greedy)throw new Error("length or greedy must be defined if stripNull is enabled.");return t.encoding=t.encoding||"utf8",this.setNextParser("string",e,t)}buffer(e,t){if(!t.length&&!t.readUntil)throw new Error("length or readUntil must be defined for buffer.");return this.setNextParser("buffer",e,t)}wrapped(e,t){if("object"!=typeof t&&"object"==typeof e&&(t=e,e=""),!t||!t.wrapper||!t.type)throw new Error("Both wrapper and type must be defined for wrapped.");if(!t.length&&!t.readUntil)throw new Error("length or readUntil must be defined for wrapped.");return this.setNextParser("wrapper",e,t)}array(e,t){if(!t.readUntil&&!t.length&&!t.lengthInBytes)throw new Error("One of readUntil, length and lengthInBytes must be defined for array.");if(!t.type)throw new Error("type is required for array.");if("string"==typeof t.type&&!r.has(t.type)&&!(t.type in n))throw new Error(`Array element type "${t.type}" is unkown.`);return this.setNextParser("array",e,t)}choice(e,t){if("object"!=typeof t&&"object"==typeof e&&(t=e,e=""),!t)throw new Error("tag and choices are are required for choice.");if(!t.tag)throw new Error("tag is requird for choice.");if(!t.choices)throw new Error("choices is required for choice.");for(const e in t.choices){const i=parseInt(e,10),s=t.choices[i];if(isNaN(i))throw new Error(`Choice key "${e}" is not a number.`);if("string"==typeof s&&!r.has(s)&&!(s in n))throw new Error(`Choice type "${s}" is unkown.`)}return this.setNextParser("choice",e,t)}nest(e,t){if("object"!=typeof t&&"object"==typeof e&&(t=e,e=""),!t||!t.type)throw new Error("type is required for nest.");if(!(t.type instanceof h||r.has(t.type)))throw new Error("type must be a known parser name or a Parser object.");if(!(t.type instanceof h||e))throw new Error("type must be a Parser object if the variable name is omitted.");return this.setNextParser("nest",e,t)}pointer(e,t){if(!t.offset)throw new Error("offset is required for pointer.");if(!t.type)throw new Error("type is required for pointer.");if("string"==typeof t.type&&!(t.type in n)&&!r.has(t.type))throw new Error(`Pointer type "${t.type}" is unkown.`);return this.setNextParser("pointer",e,t)}saveOffset(e,t={}){return this.setNextParser("saveOffset",e,t)}endianness(e){switch(e.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error('endianness must be one of "little" or "big"')}return this}endianess(e){return this.endianness(e)}useContextVars(e=!0){return this.useContextVariables=e,this}create(e){if(!(e instanceof Function))throw new Error("Constructor must be a Function object.");return this.constructorFn=e,this}getContext(e){const t=new i(e,this.useContextVariables);return t.pushCode("var dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);"),this.alias?(this.addAliasedCode(t),t.pushCode(`return ${s+this.alias}(0).result;`)):this.addRawCode(t),t}getCode(){return this.getContext("imports").code}addRawCode(e){e.pushCode("var offset = 0;"),e.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`),e.pushCode("vars.$parent = null;"),e.pushCode("vars.$root = vars;"),this.generate(e),this.resolveReferences(e),e.pushCode("delete vars.$parent;"),e.pushCode("delete vars.$root;"),e.pushCode("return vars;")}addAliasedCode(e){return e.pushCode(`function ${s+this.alias}(offset, context) {`),e.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`),e.pushCode("var ctx = Object.assign({$parent: null, $root: vars}, context || {});"),e.pushCode("vars = Object.assign(vars, ctx);"),this.generate(e),e.markResolved(this.alias),this.resolveReferences(e),e.pushCode("Object.keys(ctx).forEach(function (item) { delete vars[item]; });"),e.pushCode("return { offset: offset, result: vars };"),e.pushCode("}"),e}resolveReferences(e){const t=e.getUnresolvedReferences();e.markRequested(t),t.forEach((t=>{var i;null===(i=r.get(t))||void 0===i||i.addAliasedCode(e)}))}compile(){const e="imports",t=this.getContext(e);this.compiled=new Function(e,"TextDecoder",`return function (buffer, constructorFn) { ${t.code} };`)(t.imports,TextDecoder)}sizeOf(){let e=NaN;if(Object.keys(n).indexOf(this.type)>=0)e=n[this.type];else if("string"===this.type&&"number"==typeof this.options.length)e=this.options.length;else if("buffer"===this.type&&"number"==typeof this.options.length)e=this.options.length;else if("array"===this.type&&"number"==typeof this.options.length){let t=NaN;"string"==typeof this.options.type?t=n[this.options.type]:this.options.type instanceof h&&(t=this.options.type.sizeOf()),e=this.options.length*t}else"seek"===this.type?e=this.options.length:"nest"===this.type?e=this.options.type.sizeOf():this.type||(e=0);return this.next&&(e+=this.next.sizeOf()),e}parse(e){return this.compiled||this.compile(),this.compiled(e,this.constructorFn)}setNextParser(e,t,i){const r=new h;return r.type=e,r.varName=t,r.options=i,r.endian=this.endian,this.head?this.head.next=r:this.next=r,this.head=r,this}generate(e){if(this.type){switch(this.type){case"uint8":case"uint16le":case"uint16be":case"uint32le":case"uint32be":case"int8":case"int16le":case"int16be":case"int32le":case"int32be":case"int64be":case"int64le":case"uint64be":case"uint64le":case"floatle":case"floatbe":case"doublele":case"doublebe":this.primitiveGenerateN(this.type,e);break;case"bit":this.generateBit(e);break;case"string":this.generateString(e);break;case"buffer":this.generateBuffer(e);break;case"seek":this.generateSeek(e);break;case"nest":this.generateNest(e);break;case"array":this.generateArray(e);break;case"choice":this.generateChoice(e);break;case"pointer":this.generatePointer(e);break;case"saveOffset":this.generateSaveOffset(e);break;case"wrapper":this.generateWrapper(e)}"bit"!==this.type&&this.generateAssert(e)}const t=e.generateVariable(this.varName);return this.options.formatter&&"bit"!==this.type&&this.generateFormatter(e,t,this.options.formatter),this.generateNext(e)}generateAssert(e){if(!this.options.assert)return;const t=e.generateVariable(this.varName);switch(typeof this.options.assert){case"function":{const i=e.addImport(this.options.assert);e.pushCode(`if (!${i}.call(vars, ${t})) {`)}break;case"number":e.pushCode(`if (${this.options.assert} !== ${t}) {`);break;case"string":e.pushCode(`if (${JSON.stringify(this.options.assert)} !== ${t}) {`);break;default:throw new Error("assert option must be a string, number or a function.")}e.generateError(`"Assertion error: ${t} is " + ${JSON.stringify(this.options.assert.toString())}`),e.pushCode("}")}generateNext(e){return this.next&&(e=this.next.generate(e)),e}generateBit(e){const t=JSON.parse(JSON.stringify(this));if(t.options=this.options,t.generateAssert=this.generateAssert.bind(this),t.generateFormatter=this.generateFormatter.bind(this),t.varName=e.generateVariable(t.varName),e.bitFields.push(t),!this.next||this.next&&["bit","nest"].indexOf(this.next.type)<0){const t=e.generateTmpVariable();e.pushCode(`var ${t} = 0;`);const i=(t=0)=>{let i=0;for(let r=t;r<e.bitFields.length;r++){const t=e.bitFields[r].options.length;if(i+t>32)break;i+=t}return i},r=i=>(i<=8?(e.pushCode(`${t} = dataView.getUint8(offset);`),i=8):i<=16?(e.pushCode(`${t} = dataView.getUint16(offset);`),i=16):i<=24?(e.pushCode(`${t} = (dataView.getUint16(offset) << 8) | dataView.getUint8(offset + 2);`),i=24):(e.pushCode(`${t} = dataView.getUint32(offset);`),i=32),e.pushCode(`offset += ${i/8};`),i);let s=0;const n="be"===this.endian;let o=0,a=0;e.bitFields.forEach(((h,u)=>{let f=h.options.length;if(f>a){if(a){const i=-1>>>32-a;e.pushCode(`${h.varName} = (${t} & 0x${i.toString(16)}) << ${f-a};`),f-=a}s=0,a=o=r(i(u)-a)}const p=n?o-s-f:s,d=-1>>>32-f;e.pushCode(`${h.varName} ${f<h.options.length?"|=":"="} ${t} >> ${p} & 0x${d.toString(16)};`),32===h.options.length&&e.pushCode(`${h.varName} >>>= 0`),h.options.assert&&h.generateAssert(e),h.options.formatter&&h.generateFormatter(e,h.varName,h.options.formatter),s+=f,a-=f})),e.bitFields=[]}}generateSeek(e){const t=e.generateOption(this.options.length);e.pushCode(`offset += ${t};`)}generateString(e){const t=e.generateVariable(this.varName),i=e.generateTmpVariable(),r=this.options.encoding,s="hex"===r.toLowerCase(),n='b => b.toString(16).padStart(2, "0")';if(this.options.length&&this.options.zeroTerminated){const o=this.options.length;e.pushCode(`var ${i} = offset;`),e.pushCode(`while(dataView.getUint8(offset++) !== 0 && offset - ${i} < ${o});`);const a=`offset - ${i} < ${o} ? offset - 1 : offset`;e.pushCode(s?`${t} = Array.from(buffer.subarray(${i}, ${a}), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(${i}, ${a}));`)}else if(this.options.length){const i=e.generateOption(this.options.length);e.pushCode(s?`${t} = Array.from(buffer.subarray(offset, offset + ${i}), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(offset, offset + ${i}));`),e.pushCode(`offset += ${i};`)}else this.options.zeroTerminated?(e.pushCode(`var ${i} = offset;`),e.pushCode("while(dataView.getUint8(offset++) !== 0);"),e.pushCode(s?`${t} = Array.from(buffer.subarray(${i}, offset - 1), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(${i}, offset - 1));`)):this.options.greedy&&(e.pushCode(`var ${i} = offset;`),e.pushCode("while(buffer.length > offset++);"),e.pushCode(s?`${t} = Array.from(buffer.subarray(${i}, offset), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(${i}, offset));`));this.options.stripNull&&e.pushCode(`${t} = ${t}.replace(/\\x00+$/g, '')`)}generateBuffer(e){const t=e.generateVariable(this.varName);if("function"==typeof this.options.readUntil){const i=this.options.readUntil,r=e.generateTmpVariable(),s=e.generateTmpVariable();e.pushCode(`var ${r} = offset;`),e.pushCode(`var ${s} = 0;`),e.pushCode("while (offset < buffer.length) {"),e.pushCode(`${s} = dataView.getUint8(offset);`);const n=e.addImport(i);e.pushCode(`if (${n}.call(${e.generateVariable()}, ${s}, buffer.subarray(offset))) break;`),e.pushCode("offset += 1;"),e.pushCode("}"),e.pushCode(`${t} = buffer.subarray(${r}, offset);`)}else if("eof"===this.options.readUntil)e.pushCode(`${t} = buffer.subarray(offset);`);else{const i=e.generateOption(this.options.length);e.pushCode(`${t} = buffer.subarray(offset, offset + ${i});`),e.pushCode(`offset += ${i};`)}this.options.clone&&e.pushCode(`${t} = buffer.constructor.from(${t});`)}generateArray(e){const t=e.generateOption(this.options.length),i=e.generateOption(this.options.lengthInBytes),u=this.options.type,f=e.generateTmpVariable(),p=e.generateVariable(this.varName),d=e.generateTmpVariable(),l=this.options.key,c="string"==typeof l;if(c?e.pushCode(`${p} = {};`):e.pushCode(`${p} = [];`),"function"==typeof this.options.readUntil?e.pushCode("do {"):"eof"===this.options.readUntil?e.pushCode(`for (var ${f} = 0; offset < buffer.length; ${f}++) {`):void 0!==i?e.pushCode(`for (var ${f} = offset + ${i}; offset < ${f}; ) {`):e.pushCode(`for (var ${f} = ${t}; ${f} > 0; ${f}--) {`),"string"==typeof u)if(r.get(u)){const r=e.generateTmpVariable();if(e.pushCode(`var ${r} = ${s+u}(offset, {`),e.useContextVariables){const r=e.generateVariable();e.pushCode(`$parent: ${r},`),e.pushCode(`$root: ${r}.$root,`),this.options.readUntil||void 0!==i||e.pushCode(`$index: ${t} - ${f},`)}e.pushCode("});"),e.pushCode(`var ${d} = ${r}.result; offset = ${r}.offset;`),u!==this.alias&&e.addReference(u)}else{const t=o[u],i=a[u];e.pushCode(`var ${d} = dataView.get${t}(offset, ${i});`),e.pushCode(`offset += ${n[u]};`)}else if(u instanceof h){e.pushCode(`var ${d} = {};`);const r=e.generateVariable();e.pushScope(d),e.useContextVariables&&(e.pushCode(`${d}.$parent = ${r};`),e.pushCode(`${d}.$root = ${r}.$root;`),this.options.readUntil||void 0!==i||e.pushCode(`${d}.$index = ${t} - ${f};`)),u.generate(e),e.useContextVariables&&(e.pushCode(`delete ${d}.$parent;`),e.pushCode(`delete ${d}.$root;`),e.pushCode(`delete ${d}.$index;`)),e.popScope()}if(c?e.pushCode(`${p}[${d}.${l}] = ${d};`):e.pushCode(`${p}.push(${d});`),e.pushCode("}"),"function"==typeof this.options.readUntil){const t=this.options.readUntil,i=e.addImport(t);e.pushCode(`while (!${i}.call(${e.generateVariable()}, ${d}, buffer.subarray(offset)));`)}}generateChoiceCase(e,t,i){if("string"==typeof i){const t=e.generateVariable(this.varName);if(r.has(i)){const r=e.generateTmpVariable();e.pushCode(`var ${r} = ${s+i}(offset, {`),e.useContextVariables&&(e.pushCode(`$parent: ${t}.$parent,`),e.pushCode(`$root: ${t}.$root,`)),e.pushCode("});"),e.pushCode(`${t} = ${r}.result; offset = ${r}.offset;`),i!==this.alias&&e.addReference(i)}else{const r=o[i],s=a[i];e.pushCode(`${t} = dataView.get${r}(offset, ${s});`),e.pushCode(`offset += ${n[i]}`)}}else i instanceof h&&(e.pushPath(t),i.generate(e),e.popPath(t))}generateChoice(e){const t=e.generateOption(this.options.tag),i=e.generateVariable(this.varName);if(this.varName&&(e.pushCode(`${i} = {};`),e.useContextVariables)){const t=e.generateVariable();e.pushCode(`${i}.$parent = ${t};`),e.pushCode(`${i}.$root = ${t}.$root;`)}e.pushCode(`switch(${t}) {`);for(const t in this.options.choices){const i=parseInt(t,10),r=this.options.choices[i];e.pushCode(`case ${i}:`),this.generateChoiceCase(e,this.varName,r),e.pushCode("break;")}e.pushCode("default:"),this.options.defaultChoice?this.generateChoiceCase(e,this.varName,this.options.defaultChoice):e.generateError(`"Met undefined tag value " + ${t} + " at choice"`),e.pushCode("}"),this.varName&&e.useContextVariables&&(e.pushCode(`delete ${i}.$parent;`),e.pushCode(`delete ${i}.$root;`))}generateNest(e){const t=e.generateVariable(this.varName);if(this.options.type instanceof h){if(this.varName&&(e.pushCode(`${t} = {};`),e.useContextVariables)){const i=e.generateVariable();e.pushCode(`${t}.$parent = ${i};`),e.pushCode(`${t}.$root = ${i}.$root;`)}e.pushPath(this.varName),this.options.type.generate(e),e.popPath(this.varName),this.varName&&e.useContextVariables&&e.useContextVariables&&(e.pushCode(`delete ${t}.$parent;`),e.pushCode(`delete ${t}.$root;`))}else if(r.has(this.options.type)){const i=e.generateTmpVariable();if(e.pushCode(`var ${i} = ${s+this.options.type}(offset, {`),e.useContextVariables){const t=e.generateVariable();e.pushCode(`$parent: ${t},`),e.pushCode(`$root: ${t}.$root,`)}e.pushCode("});"),e.pushCode(`${t} = ${i}.result; offset = ${i}.offset;`),this.options.type!==this.alias&&e.addReference(this.options.type)}}generateWrapper(e){const t=e.generateVariable(this.varName),i=e.generateTmpVariable();if("function"==typeof this.options.readUntil){const t=this.options.readUntil,r=e.generateTmpVariable(),s=e.generateTmpVariable();e.pushCode(`var ${r} = offset;`),e.pushCode(`var ${s} = 0;`),e.pushCode("while (offset < buffer.length) {"),e.pushCode(`${s} = dataView.getUint8(offset);`);const n=e.addImport(t);e.pushCode(`if (${n}.call(${e.generateVariable()}, ${s}, buffer.subarray(offset))) break;`),e.pushCode("offset += 1;"),e.pushCode("}"),e.pushCode(`${i} = buffer.subarray(${r}, offset);`)}else if("eof"===this.options.readUntil)e.pushCode(`${i} = buffer.subarray(offset);`);else{const t=e.generateOption(this.options.length);e.pushCode(`${i} = buffer.subarray(offset, offset + ${t});`),e.pushCode(`offset += ${t};`)}this.options.clone&&e.pushCode(`${i} = buffer.constructor.from(${i});`);const n=e.generateTmpVariable(),o=e.generateTmpVariable(),a=e.generateTmpVariable(),u=e.addImport(this.options.wrapper);if(e.pushCode(`${i} = ${u}.call(this, ${i}).subarray(0);`),e.pushCode(`var ${n} = buffer;`),e.pushCode(`var ${o} = offset;`),e.pushCode(`var ${a} = dataView;`),e.pushCode(`buffer = ${i};`),e.pushCode("offset = 0;"),e.pushCode("dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);"),this.options.type instanceof h)this.varName&&e.pushCode(`${t} = {};`),e.pushPath(this.varName),this.options.type.generate(e),e.popPath(this.varName);else if(r.has(this.options.type)){const i=e.generateTmpVariable();e.pushCode(`var ${i} = ${s+this.options.type}(0);`),e.pushCode(`${t} = ${i}.result;`),this.options.type!==this.alias&&e.addReference(this.options.type)}e.pushCode(`buffer = ${n};`),e.pushCode(`dataView = ${a};`),e.pushCode(`offset = ${o};`)}generateFormatter(e,t,i){if("function"==typeof i){const r=e.addImport(i);e.pushCode(`${t} = ${r}.call(${e.generateVariable()}, ${t});`)}}generatePointer(e){const t=this.options.type,i=e.generateOption(this.options.offset),u=e.generateTmpVariable(),f=e.generateVariable(this.varName);if(e.pushCode(`var ${u} = offset;`),e.pushCode(`offset = ${i};`),this.options.type instanceof h){if(e.pushCode(`${f} = {};`),e.useContextVariables){const t=e.generateVariable();e.pushCode(`${f}.$parent = ${t};`),e.pushCode(`${f}.$root = ${t}.$root;`)}e.pushPath(this.varName),this.options.type.generate(e),e.popPath(this.varName),e.useContextVariables&&(e.pushCode(`delete ${f}.$parent;`),e.pushCode(`delete ${f}.$root;`))}else if(r.has(this.options.type)){const t=e.generateTmpVariable();if(e.pushCode(`var ${t} = ${s+this.options.type}(offset, {`),e.useContextVariables){const t=e.generateVariable();e.pushCode(`$parent: ${t},`),e.pushCode(`$root: ${t}.$root,`)}e.pushCode("});"),e.pushCode(`${f} = ${t}.result; offset = ${t}.offset;`),this.options.type!==this.alias&&e.addReference(this.options.type)}else if(Object.keys(n).indexOf(this.options.type)>=0){const i=o[t],r=a[t];e.pushCode(`${f} = dataView.get${i}(offset, ${r});`),e.pushCode(`offset += ${n[t]};`)}e.pushCode(`offset = ${u};`)}generateSaveOffset(e){const t=e.generateVariable(this.varName);e.pushCode(`${t} = offset`)}}var u,f=h,p=u={};p.read=function(e,t){return e.readFields(p._readField,{cameras:[],camera_count:0},t)},p._readField=function(e,t,i){1===e?t.cameras.push(d.read(i,i.readVarint()+i.pos)):2===e&&(t.camera_count=i.readVarint())},p.write=function(e,t){if(e.cameras)for(var i=0;i<e.cameras.length;i++)t.writeMessage(1,d.write,e.cameras[i]);e.camera_count&&t.writeVarintField(2,e.camera_count)};var d={};d.read=function(e,t){return e.readFields(d._readField,{frames:[],angle:0,frame_count:0,width:0,height:0,framerate:0,timescale:0,codec:""},t)},d._readField=function(e,t,i){1===e?t.frames.push(l.read(i,i.readVarint()+i.pos)):2===e?t.angle=i.readFloat():3===e?t.frame_count=i.readVarint():4===e?t.width=i.readVarint():5===e?t.height=i.readVarint():6===e?t.framerate=i.readVarint():7===e?t.timescale=i.readVarint():8===e&&(t.codec=i.readString())},d.write=function(e,t){if(e.frames)for(var i=0;i<e.frames.length;i++)t.writeMessage(1,l.write,e.frames[i]);e.angle&&t.writeFloatField(2,e.angle),e.frame_count&&t.writeVarintField(3,e.frame_count),e.width&&t.writeVarintField(4,e.width),e.height&&t.writeVarintField(5,e.height),e.framerate&&t.writeVarintField(6,e.framerate),e.timescale&&t.writeVarintField(7,e.timescale),e.codec&&t.writeStringField(8,e.codec)};var l={};l.read=function(e,t){return e.readFields(l._readField,{offset:0,size:0,timestamp:0,keyframe:!1},t)},l._readField=function(e,t,i){1===e?t.offset=i.readVarint():2===e?t.size=i.readVarint():3===e?t.timestamp=i.readVarint():4===e&&(t.keyframe=i.readBoolean())},l.write=function(e,t){e.offset&&t.writeVarintField(1,e.offset),e.size&&t.writeVarintField(2,e.size),e.timestamp&&t.writeVarintField(3,e.timestamp),e.keyframe&&t.writeBooleanField(4,e.keyframe)};var c,b,g=u,$={};function m(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}$=m,c=function(e,t,i,r,s){var n,o,a=8*s-r-1,h=(1<<a)-1,u=h>>1,f=-7,p=i?s-1:0,d=i?-1:1,l=e[t+p];for(p+=d,n=l&(1<<-f)-1,l>>=-f,f+=a;f>0;n=256*n+e[t+p],p+=d,f-=8);for(o=n&(1<<-f)-1,n>>=-f,f+=r;f>0;o=256*o+e[t+p],p+=d,f-=8);if(0===n)n=1-u;else{if(n===h)return o?NaN:1/0*(l?-1:1);o+=Math.pow(2,r),n-=u}return(l?-1:1)*o*Math.pow(2,n-r)},b=function(e,t,i,r,s,n){var o,a,h,u=8*n-s-1,f=(1<<u)-1,p=f>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,l=r?0:n-1,c=r?1:-1,b=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),(t+=o+p>=1?d/h:d*Math.pow(2,1-p))*h>=2&&(o++,h/=2),o+p>=f?(a=0,o=f):o+p>=1?(a=(t*h-1)*Math.pow(2,s),o+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,s),o=0));s>=8;e[i+l]=255&a,l+=c,a/=256,s-=8);for(o=o<<s|a,u+=s;u>0;e[i+l]=255&o,l+=c,o/=256,u-=8);e[i+l-c]|=128*b},m.Varint=0,m.Fixed64=1,m.Bytes=2,m.Fixed32=5;var w=4294967296,y=2.3283064365386963e-10,C="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function v(e){return e.type===m.Bytes?e.readVarint()+e.pos:e.pos+1}function V(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function x(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var s=i.pos-1;s>=e;s--)i.buf[s+r]=i.buf[s]}function N(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function F(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function k(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function S(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function P(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function T(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function I(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function B(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function E(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function U(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function M(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function O(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}m.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=7&r,e(s,t,this),this.pos===n&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=U(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=O(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=U(this.buf,this.pos)+U(this.buf,this.pos+4)*w;return this.pos+=8,e},readSFixed64:function(){var e=U(this.buf,this.pos)+O(this.buf,this.pos+4)*w;return this.pos+=8,e},readFloat:function(){var e=c(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=c(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,s,n=i.buf;if(s=n[i.pos++],r=(112&s)>>4,s<128)return V(e,r,t);if(s=n[i.pos++],r|=(127&s)<<3,s<128)return V(e,r,t);if(s=n[i.pos++],r|=(127&s)<<10,s<128)return V(e,r,t);if(s=n[i.pos++],r|=(127&s)<<17,s<128)return V(e,r,t);if(s=n[i.pos++],r|=(127&s)<<24,s<128)return V(e,r,t);if(s=n[i.pos++],r|=(1&s)<<31,s<128)return V(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&C?function(e,t,i){return C.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){var r="",s=t;for(;s<i;){var n,o,a,h=e[s],u=null,f=h>239?4:h>223?3:h>191?2:1;if(s+f>i)break;1===f?h<128&&(u=h):2===f?128==(192&(n=e[s+1]))&&(u=(31&h)<<6|63&n)<=127&&(u=null):3===f?(n=e[s+1],o=e[s+2],128==(192&n)&&128==(192&o)&&((u=(15&h)<<12|(63&n)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===f&&(n=e[s+1],o=e[s+2],a=e[s+3],128==(192&n)&&128==(192&o)&&128==(192&a)&&((u=(15&h)<<18|(63&n)<<12|(63&o)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,f=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),s+=f}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==m.Bytes)return e.push(this.readVarint(t));var i=v(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==m.Bytes)return e.push(this.readSVarint());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==m.Bytes)return e.push(this.readBoolean());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==m.Bytes)return e.push(this.readFloat());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==m.Bytes)return e.push(this.readDouble());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==m.Bytes)return e.push(this.readFixed32());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==m.Bytes)return e.push(this.readSFixed32());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==m.Bytes)return e.push(this.readFixed64());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==m.Bytes)return e.push(this.readSFixed64());var t=v(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===m.Varint)for(;this.buf[this.pos++]>127;);else if(t===m.Bytes)this.pos=this.readVarint()+this.pos;else if(t===m.Fixed32)this.pos+=4;else{if(t!==m.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),M(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),M(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),M(this.buf,-1&e,this.pos),M(this.buf,Math.floor(e*y),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),M(this.buf,-1&e,this.pos),M(this.buf,Math.floor(e*y),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;if(t.buf[t.pos++]|=i|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,s,n=0;n<t.length;n++){if((r=t.charCodeAt(n))>55295&&r<57344){if(!s){r>56319||n+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):s=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(e[i++]=239,e[i++]=191,e[i++]=189,s=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&x(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),b(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),b(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&x(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,m.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,N,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,F,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,P,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,k,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,S,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,T,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,I,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,B,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,E,t)},writeBytesField:function(e,t){this.writeTag(e,m.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,m.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,m.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,m.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,m.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,m.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,m.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,m.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,m.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,m.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var A=async function(t){const i=(new f).endianness("little").array("magic",{type:"uint8",length:4}).uint16("version").uint32("len_index_body"),r=(await fetch(t)).body.getReader();let s=await r.read(),n=new Uint8Array,o=!1,a=null,h=0;for(;!s.done;){if(o||(a=i.parse(s.value),h=10+a.len_index_body,o=!0),n=e(n,s.value),o&&n.length>=h){let e=new $(n.slice(10,h));return[h,g.read(e)]}s=await r.read()}};let _={mediaUrl:"https://raw.githubusercontent.com/longlongh4/multi_viewpoint_player/gh-pages/assets/video.mvv",headerSize:0,mvvIndex:null,renderer:null,players:[],currentPlayerIndex:5},D={elapsed:0};class R{constructor(e){this.cameraIndex=e,this.camera=_.mvvIndex.cameras[e],this.fetchControl=new AbortController,this.decodedFrames=[],this.decoder=null}async loadCamera(t){let i=this.decodedFrames;this.decoder=new VideoDecoder({output(e){i.push(e),requestAnimationFrame(j)},error(e){console.log(e)}}),this.decoder.configure({codec:"av01.0.01M.08",codedWidth:854,codedHeight:480});let r=(e,t)=>{let i=_.mvvIndex.cameras[e];return i.frames[t*i.framerate].offset+_.headerSize},s=this.cameraIndex===_.mvvIndex.camera_count-1?`bytes=${r(this.cameraIndex,t)}-`:`bytes=${r(this.cameraIndex,t)}-${r(this.cameraIndex+1,0)-1}`,n=await fetch(_.mediaUrl,{headers:{range:s},signal:this.fetchControl.signal}),o=this.camera.frames.slice(t*this.camera.framerate);const a=n.body.getReader();let h=await a.read(),u=new Uint8Array;for(;!h.done;)u=e(u,h.value),u=this.decodeFramesFromBuffer(o,u),h=await a.read()}decodeFramesFromBuffer(e,t){let i=0;for(;e.length>0&&e[0].size+i<=t.length;){const r=e.shift();r.keyframe&&this.decoder.flush();const s=new EncodedVideoChunk({type:r.keyframe?"key":"delta",timestamp:r.timestamp/24*1e3,duration:1/24*1e3,data:t.slice(i,i+r.size)});this.decoder.decode(s),i+=r.size}return 0===e.length&&this.decoder.flush(),t.slice(i)}}let z={cameraIndex:-1,timestamp:-1};function j(){let e=_.players[_.currentPlayerIndex].decodedFrames;if(e.length>0){for(let e=0;e<9;e++){const t=_.players[e].decodedFrames;for(;t.length>0&&t[0].timestamp<=D.elapsed-41.6;){t.shift().close()}}if(e.length>0&&e[0].timestamp<=D.elapsed){const t=e[0];z.cameraIndex===_.currentPlayerIndex&&z.timestamp===t.timestamp||(z={cameraIndex:_.currentPlayerIndex,timestamp:t.timestamp},_.renderer.draw(t))}requestAnimationFrame(j)}}self.addEventListener("message",(e=>{let[i,r]=e.data;switch(i){case"init":let e=r;_.renderer=new t(e),A(_.mediaUrl).then((([e,t])=>{_.headerSize=e,_.mvvIndex=t;for(let e=0;e<9;e++){let t=new R(e);_.players.push(t),t.loadCamera(0)}}));break;case"switchplayer":_.currentPlayerIndex=r;break;case"update":D.elapsed=r}}))})();